<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>TXT ç¿»é é›»å­æ›¸ï¼ˆå«é€²åº¦æ¢ï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        background: #f0f0f0;
        font-family: "Noto Sans TC", sans-serif;
    }

    /* å¤œé–“æ¨¡å¼ */
    body.dark {
        background: #1a1a1a;
    }
    body.dark .page {
        background: #2a2a2a;
        color: #e6e6e6;
    }
    body.dark .page:nth-child(odd) {
        background: #242424;
    }
    body.dark .control-btn {
        background: rgba(60, 60, 60, 0.7);
        color: #fff;
    }
    body.dark #progressBar {
        background: #888;
    }
    body.dark #progressValue {
        background: #00d2ff;
    }

    .book {
        width: 100vw;
        height: 100vh;
        position: relative;
        perspective: 2000px;
        overflow: hidden;
    }

    .page {
        width: 100%;
        height: 100%;
        position: absolute;
        padding: 50px 30px 30px; /* å…§å®¹å¾€ä¸‹ç§»ï¼Œé¿å…è¢«æŒ‰éˆ•æ“‹åˆ° */
        top: 0;
        left: 0;
        box-sizing: border-box;
        background: white;
        transform-origin: left center;
        transition: transform 0.6s ease;
        box-shadow: 0 0 15px rgba(0,0,0,0.25);
        line-height: 1.8;
        font-size: 20px;
        overflow-y: auto;
    }

    .page.flipped {
        transform: rotateY(-180deg);
        z-index: 1 !important;
    }

    /* é€²åº¦æ¢ */
    #progressBar {
        position: absolute;
        top: 0;
        left: 0;
        height: 5px;
        width: 100%;
        background: #ccc;
        z-index: 999;
    }

    #progressValue {
        height: 100%;
        width: 0%;
        background: #4aa3ff;
        transition: width 0.3s ease;
    }

    /* ä¸Šæ–¹æŒ‰éˆ•ï¼ˆæ–‡å­—å¤§å° / å¤œé–“æ¨¡å¼ï¼‰ */
    .controls {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 10px;
        z-index: 999;
    }

    .control-btn {
        background: rgba(255,255,255,0.7);
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        user-select: none;
        backdrop-filter: blur(4px);  /* åŠé€æ˜ä¸æ“‹å­— */
    }
</style>
</head>
<body>

<!-- é€²åº¦æ¢ -->
<div id="progressBar"><div id="progressValue"></div></div>

<!-- æ§åˆ¶æŒ‰éˆ• -->
<div class="controls">
    <div class="control-btn" id="fontPlus">A+</div>
    <div class="control-btn" id="fontMinus">Aâ€“</div>
    <div class="control-btn" id="modeToggle">ğŸŒ™</div>
</div>

<div class="book" id="book"></div>

<script>
/* TXT æª”æ¡ˆä¾†æº */
const TEXT_URL = "èªªé»å…”èµ¤-ä¾†éƒ½ä¾†äº†.txt";

/* ä¸‹è¼‰æ–‡å­— */
async function loadTextFile() {
    const res = await fetch(TEXT_URL);
    return await res.text();
}

/* è‡ªå‹•åˆ†é  */
function paginateText(text, fontSize = 20) {
    const pageHeight = window.innerHeight - 90; // é¿é–‹æŒ‰éˆ• + é€²åº¦æ¢

    const temp = document.createElement("div");
    temp.style.position = "absolute";
    temp.style.visibility = "hidden";
    temp.style.width = "90%";
    temp.style.fontSize = fontSize + "px";
    temp.style.lineHeight = "1.8";
    temp.style.fontFamily = "Noto Sans TC";
    document.body.appendChild(temp);

    const lines = text.split("\n");
    let current = "";
    let pages = [];

    for (let line of lines) {
        temp.innerHTML = current + line + "<br>";
        if (temp.offsetHeight > pageHeight) {
            pages.push(current);
            current = line + "<br>";
        } else {
            current += line + "<br>";
        }
    }
    pages.push(current);

    temp.remove();
    return pages;
}

/* å»ºç«‹é é¢ */
function buildPages(pages) {
    const book = document.getElementById("book");
    book.innerHTML = "";

    pages.forEach((text, i) => {
        const page = document.createElement("div");
        page.className = "page";
        page.style.zIndex = pages.length - i;
        page.innerHTML = text;
        book.appendChild(page);
    });
}

/* ç¿»é åŠŸèƒ½ */
let currentPage = 0;

function updateProgress() {
    const pages = document.querySelectorAll(".page");
    const percent = (currentPage / (pages.length - 1)) * 100;
    document.getElementById("progressValue").style.width = percent + "%";
}

function attachFlipEvents() {
    let startX = 0;

    document.addEventListener("touchstart", e => {
        startX = e.touches[0].clientX;
    });

    document.addEventListener("touchend", e => {
        const endX = e.changedTouches[0].clientX;
        const diff = endX - startX;
        const pages = document.querySelectorAll(".page");

        if (Math.abs(diff) < 40) return;

        if (diff < 0 && currentPage < pages.length - 1) {
            pages[currentPage].classList.add("flipped");
            currentPage++;
            updateProgress();
        } else if (diff > 0 && currentPage > 0) {
            currentPage--;
            pages[currentPage].classList.remove("flipped");
            updateProgress();
        }
    });
}

/* å­—é«”å¤§å° */
let baseFont = 20;
function applyFont() {
    document.querySelectorAll(".page").forEach(p => p.style.fontSize = baseFont + "px");
}
document.getElementById("fontPlus").onclick = () => { baseFont += 2; applyFont(); };
document.getElementById("fontMinus").onclick = () => { if (baseFont > 12) baseFont -= 2; applyFont(); };

/* å¤œé–“æ¨¡å¼ */
document.getElementById("modeToggle").onclick = () => {
    document.body.classList.toggle("dark");
    document.getElementById("modeToggle").textContent =
        document.body.classList.contains("dark") ? "â˜€ï¸" : "ğŸŒ™";
};

/* ä¸»ç¨‹åº */
(async () => {
    const text = await loadTextFile();
    const pages = paginateText(text, baseFont);
    buildPages(pages);
    attachFlipEvents();
    updateProgress();
})();
</script>

</body>
</html>
